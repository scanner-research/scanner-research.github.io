
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />

<title>Operations - Scanner</title>


    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Stored Streams" href="stored-streams.html" />
    <link rel="prev" title="Computation Graphs" href="graphs.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-133298183-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-133298183-1');
</script>


  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="stored-streams.html" title="Stored Streams"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="graphs.html" title="Computation Graphs"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Scanner 0.2.22 documentation</a> &#187;</li> 
      </ul>
    </div>
<div class="container">
  <div id="navbar" class="navbar-default">
    <div class="row">
      <div class="col-md-4 col-sm-12">
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/scanner_logo.png"></span>
        </a>
      </div>
      <div class="col-md-4 offset-md-4 col-sm-12">
        <div class="btn-group">
          <a href="../guide.html"><button type="button" class="btn btn-light">Guide</button></a>
          <a href="../api.html"><button type="button" class="btn btn-light">API</button></a>
          <a href="https://github.com/scanner-research/scanner"><button type="button" class="btn btn-light">Github</button></a>
          <a href="../publications.html"><button type="button" class="btn btn-light">Publications</button></a>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
      <div class="bs-sidenav">
        <div class="bs-sidenav-inner"><div class="guidetoc-container">
  <div class="guidetoc"
       role="navigation">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#homebrew">Homebrew</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#from-source">From Source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="walkthrough.html">Walkthroughs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="walkthrough.html#converting-a-video-to-grayscale">Converting a video to grayscale</a></li>
<li class="toctree-l2"><a class="reference internal" href="walkthrough.html#walking-through-a-more-advanced-jupyter-based-app">Walking through a more advanced Jupyter-based app</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="graphs.html">Computation Graphs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="graphs.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="graphs.html#multiple-inputs-and-outputs">Multiple inputs and outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="graphs.html#batch-processing-of-stored-streams">Batch processing of stored streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="graphs.html#stream-operations">Stream Operations</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Operations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-an-operation-in-python">Defining an Operation in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#declaring-parameters">Declaring Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fetching-resources">Fetching Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#operation-properties">Operation Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-an-operation-in-c">Defining an Operation in C++</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="stored-streams.html">Stored Streams</a><ul>
<li class="toctree-l2"><a class="reference internal" href="stored-streams.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="stored-streams.html#storage-backends">Storage Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="stored-streams.html#i-o-operations">I/O Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="stored-streams.html#reading-data-locally">Reading Data Locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="stored-streams.html#deleting-stored-streams">Deleting Stored Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="stored-streams.html#inplace-video-indexing">Inplace video indexing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="profiling.html">Performance Profiling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="profiling.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling.html#trace-visualization">Trace Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling.html#scanner-s-execution-model">Scanner’s Execution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling.html#tunable-parameters">Tunable Parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes Integration</a></li>
</ul>

  </div>
</div>
        </div>
      </div>
    </div>
    <div class="col-md-9">
      <div class="content">
        
  <div class="section" id="operations">
<span id="ops"></span><h1>Operations<a class="headerlink" href="#operations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Processing data in Scanner occurs primarily through <em>operations</em> (<em>ops</em>). Operations are built-in or user defined functionality that transform streams of input elements to streams of output elements. For example, this <code class="code docutils literal notranslate"><span class="pre">Resize</span></code> operation transforms input frames by resizing them to a target width and height:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scannerpy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scannertools.imgproc</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="o">...</span>
<span class="n">sc</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="n">input_frames</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">[</span><span class="mi">640</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="mi">480</span><span class="p">])</span>
</pre></div>
</div>
<p>Follow the rest of this guide to understand how to write your own operations.</p>
</div>
<div class="section" id="defining-an-operation-in-python">
<h2>Defining an Operation in Python<a class="headerlink" href="#defining-an-operation-in-python" title="Permalink to this headline">¶</a></h2>
<p>Scanner supports defining operations in Python using the following syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scannerpy</span> <span class="k">as</span> <span class="nn">sp</span>

<span class="nd">@sp</span><span class="o">.</span><span class="n">register_python_op</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">PersonDetectorDNN</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">Kernel</span><span class="p">):</span>
    <span class="c1"># Init runs once when the class instance is initialized</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">model_url</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_url</span> <span class="o">=</span> <span class="n">model_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local_model_path</span> <span class="o">=</span> <span class="s1">&#39;/tmp/model&#39;</span>

    <span class="k">def</span> <span class="nf">fetch_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">download_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_model_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_with_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_model_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># load and setup the model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">new_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">threshold</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">sp</span><span class="o">.</span><span class="n">FrameType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoundingBoxList</span><span class="p">:</span>
        <span class="n">person_boxes</span><span class="p">,</span> <span class="n">confidences</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">box</span>
                <span class="k">for</span> <span class="n">box</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">person_boxes</span><span class="p">,</span> <span class="n">confidences</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">conf</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span><span class="p">]</span>
</pre></div>
</div>
<p>We now have an operation defined named <code class="code docutils literal notranslate"><span class="pre">PersonDetectorDNN</span></code> which can be instantiated using a client object named <code class="code docutils literal notranslate"><span class="pre">sc</span></code> like this: <code class="code docutils literal notranslate"><span class="pre">sc.ops.PersonDetectorDNN(frame=...,</span> <span class="pre">model_url=...,</span> <span class="pre">threshold=[...])</span></code>. The rest of this guide will explain the above piece of code in more detail. First, let’s start with the way parameters to the operation.</p>
</div>
<div class="section" id="declaring-parameters">
<span id="id1"></span><h2>Declaring Parameters<a class="headerlink" href="#declaring-parameters" title="Permalink to this headline">¶</a></h2>
<p>Parameters to operations can be declared at one of three locations:</p>
<ul class="simple">
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code>: the constructor for the operation.</p></li>
<li><p><a class="reference internal" href="../api/scannerpy.html#scannerpy.kernel.Kernel.new_stream" title="scannerpy.kernel.Kernel.new_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">new_stream()</span></code></a>: called whenever the operation starts processing a new stream.</p></li>
<li><p><a class="reference internal" href="../api/scannerpy.html#scannerpy.kernel.Kernel.execute" title="scannerpy.kernel.Kernel.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">execute()</span></code></a>: called with input stream elements to produce transformed output elements.</p></li>
</ul>
<p>The frequency at which each of these functions is invoked is called its <em>rate</em>.</p>
<div class="section" id="init-parameters">
<h3>Init Parameters<a class="headerlink" href="#init-parameters" title="Permalink to this headline">¶</a></h3>
<p>Init parameters are specified once and given to the constructor of an operation, and then never changed. For example, the <code class="code docutils literal notranslate"><span class="pre">model_url</span></code> parameter to the <code class="code docutils literal notranslate"><span class="pre">PersonDetectorDNN</span></code> operation is a init parameter as it is specified in the <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code> method to the class.</p>
</div>
<div class="section" id="stream-config-parameters">
<span id="id2"></span><h3>Stream Config Parameters<a class="headerlink" href="#stream-config-parameters" title="Permalink to this headline">¶</a></h3>
<p>Stream config parameters are provided to an operation before processing elements from a stream in a batch of streams (see <a class="reference internal" href="graphs.html#batch-processing"><span class="std std-ref">Batch processing of stored streams</span></a>). For example, the <code class="code docutils literal notranslate"><span class="pre">threshold</span></code> parameter specified in the <a class="reference internal" href="../api/scannerpy.html#scannerpy.kernel.Kernel.new_stream" title="scannerpy.kernel.Kernel.new_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">new_stream()</span></code></a> method of the <code class="code docutils literal notranslate"><span class="pre">PersonDetectorDNN</span></code> operation is a stream config parameter. For each stream in the batch of streams being processed, Scanner expects a separate <code class="code docutils literal notranslate"><span class="pre">threshold</span></code> parameter to be provided. This is done by passing a list like so: <code class="code docutils literal notranslate"><span class="pre">PersonDetectorDNN(threshold=[0.5,</span> <span class="pre">0.6,</span> <span class="pre">...,</span> <span class="pre">0.2],</span> <span class="pre">...)</span></code>.</p>
</div>
<div class="section" id="stream-parameters">
<span id="id3"></span><h3>Stream Parameters<a class="headerlink" href="#stream-parameters" title="Permalink to this headline">¶</a></h3>
<p>Stream parameters are parameters that bind to streams and are processed element at a time by the operation. For the <code class="code docutils literal notranslate"><span class="pre">PersonDetectorDNN</span></code> operation, the <code class="code docutils literal notranslate"><span class="pre">frame</span></code> parameter specified in the <a class="reference internal" href="../api/scannerpy.html#scannerpy.kernel.Kernel.execute" title="scannerpy.kernel.Kernel.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">execute()</span></code></a> method is a stream parameter. Stream parameters must be annotated with a type so that Scanner understands how to serialize and deserialize the data. The following types are supported:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/scannerpy.html#scannerpy.types.FrameType" title="scannerpy.types.FrameType"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameType</span></code></a>: a built-in type that represents frames from a video. In Python operations, parameters of this type are represented with numpy arrays.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>: these parameters represent blobs of binary data.</p></li>
<li><p>User-defined types: Scanner supports registering custom types for stream parameters. See the next section to find out how to do that!</p></li>
</ul>
</div>
<div class="section" id="stream-parameter-types">
<h3>Stream Parameter Types<a class="headerlink" href="#stream-parameter-types" title="Permalink to this headline">¶</a></h3>
<p>Stream parameter types tell Scanner how to serialize and deserialize the elements in streams and the inputs/outputs to operations. One can define their own custom stream parameter type in Python by calling <a class="reference internal" href="../api/scannerpy.html#scannerpy.types.register_type" title="scannerpy.types.register_type"><code class="xref py py-func docutils literal notranslate"><span class="pre">scannerpy.types.register_type()</span></code></a>. For example, to register a new type for numpy float32 arrays, we can write the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scannerpy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scannerpy.types</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nd">@sp</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">register_type</span>
<span class="k">class</span> <span class="nc">NumpyArrayFloat32</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">data_buffer</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data_buffer</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<p>A custom type implements a <code class="code docutils literal notranslate"><span class="pre">serialize</span></code> method, which takes an instance of the type and converts it to a byte buffer, and a <code class="code docutils literal notranslate"><span class="pre">deserialize</span></code> method, which takes a byte buffer produced by calling <code class="code docutils literal notranslate"><span class="pre">serialize</span></code> and converts it back into an instance of the type.</p>
</div>
</div>
<div class="section" id="fetching-resources">
<h2>Fetching Resources<a class="headerlink" href="#fetching-resources" title="Permalink to this headline">¶</a></h2>
<p>Some operations require external resources to be download or fetched before they can start processing data. In the case of the <code class="code docutils literal notranslate"><span class="pre">PersonDetectorDNN</span></code> operation, it requires the model weights for its deep neural network. To download external resources, operations should implement the following two methods:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/scannerpy.html#scannerpy.kernel.Kernel.fetch_resources" title="scannerpy.kernel.Kernel.fetch_resources"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scannerpy.kernel.Kernel.fetch_resources()</span></code></a>: To avoid redownloading resources that are shared across instances of an operation, this method is called once per machine to download resources.</p></li>
<li><p><a class="reference internal" href="../api/scannerpy.html#scannerpy.kernel.Kernel.setup_with_resources" title="scannerpy.kernel.Kernel.setup_with_resources"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scannerpy.kernel.Kernel.setup_with_resources()</span></code></a>: Once <a class="reference internal" href="../api/scannerpy.html#scannerpy.kernel.Kernel.fetch_resources" title="scannerpy.kernel.Kernel.fetch_resources"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fetch_resources()</span></code></a> has been executed, this method is called for every instance of that operation after <code class="code docutils literal notranslate"><span class="pre">__init__</span></code>.</p></li>
</ul>
</div>
<div class="section" id="operation-properties">
<h2>Operation Properties<a class="headerlink" href="#operation-properties" title="Permalink to this headline">¶</a></h2>
<p>Scanner operations can be annotated with several different properties to change their functionality.</p>
<div class="section" id="device-sets">
<h3>Device Sets<a class="headerlink" href="#device-sets" title="Permalink to this headline">¶</a></h3>
<p>By default, Scanner will assume operations only use the CPU when processing data. If an operation utilizes the GPU when processing elements, it can declare that it requires that device type during op declaration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@sp</span><span class="o">.</span><span class="n">register_python_op</span><span class="p">(</span><span class="n">device_sets</span><span class="o">=</span><span class="p">[(</span><span class="n">DeviceType</span><span class="o">.</span><span class="n">GPU</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
<span class="k">class</span> <span class="nc">GpuOp</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="batch">
<h3>Batch<a class="headerlink" href="#batch" title="Permalink to this headline">¶</a></h3>
<p>Many operations benefit from being able to process a <em>batch</em> of elements all at once, especially when using the GPU. Operations can declare they are able to process batches of elements at once using the <code class="code docutils literal notranslate"><span class="pre">batch</span></code> property:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span>

<span class="nd">@sp</span><span class="o">.</span><span class="n">register_python_op</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BatchOp</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">FrameType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">FrameType</span><span class="p">]:</span>
        <span class="c1"># process a batch of frames</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Notice how the signature of the <code class="code docutils literal notranslate"><span class="pre">execute</span></code> method changed. Since we are processing a batch of input, the <code class="code docutils literal notranslate"><span class="pre">frame</span></code> parameter and the output are now lists of frames instead of a single frame.</p>
</div>
<div class="section" id="stencil">
<h3>Stencil<a class="headerlink" href="#stencil" title="Permalink to this headline">¶</a></h3>
<p>Some operations require looking at a window of data over time. For example, computing optical flow requires both the current and next frame in time. These operations can indicate they require a <code class="code docutils literal notranslate"><span class="pre">stencil</span></code> of frames:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span>

<span class="nd">@sp</span><span class="o">.</span><span class="n">register_python_op</span><span class="p">(</span><span class="n">stencil</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="k">class</span> <span class="nc">OpticalFlow</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">FrameType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">sp</span><span class="o">.</span><span class="n">FrameType</span><span class="p">:</span>
        <span class="c1"># process a window of frames</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Like with the <code class="code docutils literal notranslate"><span class="pre">batch</span></code> property, the signature of the <code class="code docutils literal notranslate"><span class="pre">execute</span></code> method changed. However, instead of both the input and output becoming lists of frames, only the input did. This is because the operation needs a list of frames as input, but still produces a single output element for each invocation of <code class="code docutils literal notranslate"><span class="pre">execute</span></code>.</p>
</div>
</div>
<div class="section" id="defining-an-operation-in-c">
<h2>Defining an Operation in C++<a class="headerlink" href="#defining-an-operation-in-c" title="Permalink to this headline">¶</a></h2>
<p>For performance critical operations, Scanner also supports defining operations in C++. Check out the tutorial <a class="reference external" href="https://github.com/scanner-research/scanner/blob/master/examples/tutorials/08_defining_cpp_ops.py">08_defining_cpp_ops.py</a> to find out how to write your own C++ operation.</p>
</div>
</div>


      </div>
    </div>
  </div>
</div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="stored-streams.html" title="Stored Streams"
             >next</a> |</li>
        <li class="right" >
          <a href="graphs.html" title="Computation Graphs"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Scanner 0.2.22 documentation</a> &#187;</li> 
      </ul>
    </div>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/python.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>